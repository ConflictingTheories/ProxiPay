FROM node:12-alpine

WORKDIR /opt

RUN mkdir proxi

WORKDIR /opt/proxi

COPY . .

# create a group and user
RUN addgroup -S appgroup && adduser -S appuser -G appgroup

RUN apk add --no-cache bash

# postgresql-client is needed if/when we run "wait-for-postgres.sh" (in ./scripts) to make sure Postgres is ready to execute SQL scripts.
RUN npm cache clean --force &&\
    npm install uglifycss uglifyjs --global &&\
    npm install &&\
    npm run build 

EXPOSE 8000

# run all future commands as this user
USER appuser 

CMD ["node", "/opt/proxi/bin/ProxiPay"]
